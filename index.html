<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic Designer Pro - Solver Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f8fafc; }
        .canvas-grid {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 25px 25px;
        }
        .wire-active { stroke-dasharray: 8; animation: flow 1s linear infinite; }
        @keyframes flow { to { stroke-dashoffset: -16; } }
        .gate-node { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        const GATE_CONFIGS = {
            AND: { color: '#3b82f6', d: "M 5 10 Q 25 10 35 25 Q 25 40 5 40 Z" },
            OR: { color: '#10b981', d: "M 5 10 Q 20 10 35 25 Q 20 40 5 40 Q 12 25 5 10 Z" },
            NOT: { color: '#ef4444', d: "M 5 10 L 30 25 L 5 40 Z" },
            SWITCH: { color: '#64748b', special: 'switch' },
            BULB: { color: '#eab308', special: 'bulb' }
        };

        const App = () => {
            const [nodes, setNodes] = useState([]);
            const [connections, setConnections] = useState([]);
            const [results, setResults] = useState({});
            const [equation, setEquation] = useState("A.B + !A");
            const canvasRef = useRef(null);

            // Simulation Logic
            const runSimulation = useCallback(() => {
                const newResults = {};
                const processed = new Set();

                const evaluate = (nodeId) => {
                    if (processed.has(nodeId)) return newResults[nodeId];
                    const node = nodes.find(n => n.id === nodeId);
                    if (!node) return false;

                    if (node.type === 'SWITCH') {
                        newResults[nodeId] = !!node.state;
                    } else {
                        const incoming = connections
                            .filter(c => c.toId === nodeId)
                            .map(c => evaluate(c.fromId));

                        let res = false;
                        switch (node.type) {
                            case 'AND': res = incoming.length >= 2 && incoming.every(v => v); break;
                            case 'OR': res = incoming.length > 0 && incoming.some(v => v); break;
                            case 'NOT': res = incoming.length > 0 ? !incoming[0] : false; break;
                            case 'BULB': res = incoming.length > 0 ? incoming[0] : false; break;
                        }
                        newResults[nodeId] = res;
                    }
                    processed.add(nodeId);
                    return newResults[nodeId];
                };

                nodes.forEach(n => evaluate(n.id));
                setResults(newResults);
            }, [nodes, connections]);

            useEffect(() => { runSimulation(); }, [nodes, connections, runSimulation]);

            // Auto Generator Logic
            const generateCircuit = () => {
                let newNodes = [];
                let newConnections = [];
                
                // Simple parser for demonstration: Handles A.B + !A style
                // Step 1: Create Switches for A and B
                const switchA = { id: 'sw-A', type: 'SWITCH', label: 'A', x: 50, y: 100, state: false };
                const switchB = { id: 'sw-B', type: 'SWITCH', label: 'B', x: 50, y: 200, state: false };
                newNodes.push(switchA, switchB);

                // Logic based on equation string (Naive implementation)
                if (equation.includes('!A')) {
                    const notGate = { id: 'not-1', type: 'NOT', x: 200, y: 100 };
                    newNodes.push(notGate);
                    newConnections.push({ id: 'c1', fromId: 'sw-A', toId: 'not-1' });
                }

                if (equation.includes('A.B') || equation.includes('A*B')) {
                    const andGate = { id: 'and-1', type: 'AND', x: 200, y: 200 };
                    newNodes.push(andGate);
                    newConnections.push({ id: 'c2', fromId: 'sw-A', toId: 'and-1' });
                    newConnections.push({ id: 'c3', fromId: 'sw-B', toId: 'and-1' });
                }

                if (equation.includes('+')) {
                    const orGate = { id: 'or-1', type: 'OR', x: 350, y: 150 };
                    newNodes.push(orGate);
                    // Connect inputs to OR
                    if (newNodes.find(n => n.id === 'not-1')) newConnections.push({ id: 'c4', fromId: 'not-1', toId: 'or-1' });
                    if (newNodes.find(n => n.id === 'and-1')) newConnections.push({ id: 'c5', fromId: 'and-1', toId: 'or-1' });
                }

                const bulb = { id: 'bulb-1', type: 'BULB', x: 500, y: 150 };
                newNodes.push(bulb);
                const lastGate = newNodes[newNodes.length - 2];
                newConnections.push({ id: 'c-final', fromId: lastGate.id, toId: 'bulb-1' });

                setNodes(newNodes);
                setConnections(newConnections);
            };

            return (
                <div className="flex flex-col h-screen text-slate-800 font-sans">
                    <header className="h-20 bg-white border-b flex items-center justify-between px-8 shadow-sm z-20">
                        <div className="flex items-center gap-4">
                            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold shadow-lg">Σ</div>
                            <div>
                                <h1 className="font-black text-lg">LOGIC SOLVER</h1>
                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Auto Circuit Generator</p>
                            </div>
                        </div>

                        <div className="flex flex-1 max-w-xl mx-10 gap-2">
                            <input 
                                value={equation}
                                onChange={(e) => setEquation(e.target.value)}
                                className="flex-1 px-4 py-2 bg-slate-100 border-2 border-transparent focus:border-blue-500 rounded-lg outline-none font-mono text-sm"
                                placeholder="উদা: A.B + !A"
                            />
                            <button 
                                onClick={generateCircuit}
                                className="px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition shadow-md whitespace-nowrap"
                            >
                                ড্র করো
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 relative canvas-grid bg-white overflow-hidden" ref={canvasRef}>
                        <svg className="absolute inset-0 w-full h-full pointer-events-none">
                            {connections.map(c => {
                                const fn = nodes.find(n => n.id === c.fromId);
                                const tn = nodes.find(n => n.id === c.toId);
                                if (!fn || !tn) return null;
                                const active = results[fn.id];
                                return (
                                    <path 
                                        key={c.id} 
                                        d={`M ${fn.x + 100} ${fn.y + 40} C ${fn.x + 130} ${fn.y + 40}, ${tn.x - 30} ${tn.y + 40}, ${tn.x} ${tn.y + 40}`} 
                                        fill="none" 
                                        stroke={active ? '#3b82f6' : '#e2e8f0'} 
                                        strokeWidth={active ? 4 : 2}
                                        className={active ? 'wire-active' : ''}
                                    />
                                );
                            })}
                        </svg>

                        {nodes.map(node => (
                            <div 
                                key={node.id} 
                                style={{ left: node.x, top: node.y }}
                                className={`gate-node absolute w-28 h-20 bg-white border-2 rounded-2xl shadow-sm flex flex-col items-center justify-center ${results[node.id] ? 'border-blue-500 ring-4 ring-blue-50' : 'border-slate-100'}`}
                            >
                                <div className="flex flex-col items-center">
                                    {node.type === 'SWITCH' ? (
                                        <button 
                                            onClick={() => setNodes(nodes.map(n => n.id === node.id ? {...n, state: !n.state} : n))}
                                            className={`w-12 h-6 rounded-full transition-all relative ${node.state ? 'bg-blue-600' : 'bg-slate-300'}`}
                                        >
                                            <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${node.state ? 'left-7' : 'left-1'}`}></div>
                                        </button>
                                    ) : node.type === 'BULB' ? (
                                        <div className={`w-8 h-8 rounded-full border-4 ${results[node.id] ? 'bg-yellow-400 border-yellow-500 shadow-xl' : 'bg-slate-100 border-slate-200'}`} />
                                    ) : (
                                        <svg viewBox="0 0 50 50" className="h-10">
                                            <path d={GATE_CONFIGS[node.type].d} fill="none" stroke={GATE_CONFIGS[node.type].color} strokeWidth="3" />
                                        </svg>
                                    )}
                                    <span className="text-[10px] font-black uppercase text-slate-400 mt-1">{node.label || node.type}</span>
                                </div>
                            </div>
                        ))}
                    </main>

                    <footer className="h-10 bg-slate-900 text-white flex items-center px-8 text-xs font-bold gap-6">
                        <span className="text-blue-400">ব্যবহৃত চিহ্ন:</span>
                        <span>( . ) = AND</span>
                        <span>( + ) = OR</span>
                        <span>( ! ) = NOT</span>
                        <div className="ml-auto opacity-50 italic uppercase tracking-tighter">Automatic Logic Solving Engine v1.0</div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
